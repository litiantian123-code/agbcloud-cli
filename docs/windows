# PowerShell script to download and install AgbCloud CLI
# This script downloads the actual installer from the repository

$ErrorActionPreference = "Stop"

Write-Host "AgbCloud CLI Windows Installer" -ForegroundColor Green
Write-Host "==============================" -ForegroundColor Green
Write-Host ""

# Download the actual install script from the repository
$installScriptUrl = "https://raw.githubusercontent.com/litiantian123-code/agbcloud-cli/main/server-files/install.ps1"
$tempPath = "$env:TEMP\agbcloud-install.ps1"

try {
    Write-Host "[INFO] Downloading installer script..." -ForegroundColor Yellow
    Invoke-WebRequest -Uri $installScriptUrl -OutFile $tempPath -UseBasicParsing
    
    Write-Host "[INFO] Running installer..." -ForegroundColor Yellow
    Write-Host ""
    
    # Execute the downloaded script
    & PowerShell -ExecutionPolicy Bypass -File $tempPath
    
    # Clean up
    Remove-Item $tempPath -ErrorAction SilentlyContinue
    
} catch {
    Write-Error "Failed to download or execute installer: $_"
    Write-Host ""
    Write-Host "Manual installation options:" -ForegroundColor Yellow
    Write-Host "1. Download install.ps1 directly from:" -ForegroundColor White
    Write-Host "   https://raw.githubusercontent.com/litiantian123-code/agbcloud-cli/main/server-files/install.ps1" -ForegroundColor Cyan
    Write-Host ""
    Write-Host "2. Or visit the releases page:" -ForegroundColor White
    Write-Host "   https://github.com/litiantian123-code/agbcloud-cli/releases" -ForegroundColor Cyan
    exit 1
}